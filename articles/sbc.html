<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SBC for flocker models • flocker</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="SBC for flocker models">
<meta property="og:description" content="flocker">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flocker</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0-0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/sbc.html">SBC for flocker models</a>
    </li>
    <li>
      <a href="../articles/augmented_models.html">Data-augmented models in flocker</a>
    </li>
    <li>
      <a href="../articles/flocker_format.html">Advanced brms custom families: occupancy models and the `flocker_data` format</a>
    </li>
    <li>
      <a href="../articles/flocker_tutorial.html">Fitting occupancy models with flocker</a>
    </li>
    <li>
      <a href="../articles/multiseason_models.html">Multiseason models in flocker</a>
    </li>
    <li>
      <a href="../articles/nonlinear_models.html">Nonlinear models in flocker</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jsocolar/flocker/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>SBC for flocker models</h1>
                        <h4 data-toc-skip class="author">Jacob
Socolar</h4>
            
            <h4 data-toc-skip class="date">2023-10-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jsocolar/flocker/blob/HEAD/vignettes/articles/sbc.Rmd" class="external-link"><code>vignettes/articles/sbc.Rmd</code></a></small>
      <div class="hidden name"><code>sbc.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  n_sims <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  n_sites <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  n_sims_augmented <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  n_sites_augmented <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  n_pseudospecies_augmented <span class="op">=</span> <span class="fl">50</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jsocolar/flocker" class="external-link">flocker</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms" class="external-link">brms</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SBC</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This document performs simulation-based calibration for the models
available in R package <code>flocker</code>. Here, our goal is to
validate <code>flocker</code>’s data formatting, decoding, and
likelihood implementations, and not <code>brms</code>’s construction of
the linear predictors.</p>
<p>The encoding of the data for a <code>flocker</code> model tends to be
more complex in the presence of missing observations, and so we include
missingness in the data simulation wherever possible (some visits
missing in all models, some time-steps missing in multiseason
models).</p>
<p>In all models, we include one unit covariate that affects detection
and occupancy, colonization, extinction and/or autologistic terms as
applicable, and one event covariate that affects detection only (for all
models except the rep-constant).</p>
</div>
<div class="section level2">
<h2 id="single-season">Single-season<a class="anchor" aria-label="anchor" href="#single-season"></a>
</h2>
<div class="section level3">
<h3 id="rep-constant">Rep-constant<a class="anchor" aria-label="anchor" href="#rep-constant"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make the stancode</span></span>
<span><span class="va">model_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/sbc_rep_constant_model.stan"</span><span class="op">)</span></span>
<span><span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_flocker_data.html">simulate_flocker_data</a></span><span class="op">(</span></span>
<span>  n_pt <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">n_sites</span>, n_sp <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    coefs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      det_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      det_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      occ_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      occ_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  rep_constant <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ragged_rep <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">flocker_data</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_flocker_data.html">make_flocker_data</a></span><span class="op">(</span><span class="va">fd</span><span class="op">$</span><span class="va">obs</span>, <span class="va">fd</span><span class="op">$</span><span class="va">unit_covs</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">scode</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flocker_stancode.html">flocker_stancode</a></span><span class="op">(</span></span>
<span>    f_occ <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span>,</span>
<span>    f_det <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span>,</span>
<span>    flocker_data <span class="op">=</span> <span class="va">flocker_data</span>,</span>
<span>    prior <span class="op">=</span> </span>
<span>      <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span><span class="st">"std_normal()"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span><span class="st">"std_normal()"</span>, dpar <span class="op">=</span> <span class="st">"occ"</span><span class="op">)</span>,</span>
<span>    backend <span class="op">=</span> <span class="st">"cmdstanr"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">scode</span>, <span class="va">model_name</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rep_constant_generator</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">{</span>  </span>
<span>  <span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_flocker_data.html">simulate_flocker_data</a></span><span class="op">(</span></span>
<span>    n_pt <span class="op">=</span> <span class="va">N</span>, n_sp <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      coefs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        det_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        det_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        occ_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        occ_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    rep_constant <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    ragged_rep <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">flocker_data</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_flocker_data.html">make_flocker_data</a></span><span class="op">(</span><span class="va">fd</span><span class="op">$</span><span class="va">obs</span>, <span class="va">fd</span><span class="op">$</span><span class="va">unit_covs</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># format for return</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      `b[1]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">det_intercept</span>,</span>
<span>      `b[2]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">det_slope_unit</span>,</span>
<span>      `b_occ[1]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">occ_intercept</span>,</span>
<span>      `b_occ[2]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">occ_slope_unit</span></span>
<span>    <span class="op">)</span>,</span>
<span>    generated <span class="op">=</span> <span class="fu"><a href="../reference/flocker_standata.html">flocker_standata</a></span><span class="op">(</span></span>
<span>      f_occ <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span>,</span>
<span>      f_det <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span>,</span>
<span>      flocker_data <span class="op">=</span> <span class="va">flocker_data</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">rep_constant_gen</span> <span class="op">&lt;-</span> <span class="fu">SBC_generator_function</span><span class="op">(</span></span>
<span>  <span class="va">rep_constant_generator</span>, </span>
<span>  N <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">n_sites</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">rep_constant_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span></span>
<span>  <span class="fu">generate_datasets</span><span class="op">(</span><span class="va">rep_constant_gen</span>, <span class="va">params</span><span class="op">$</span><span class="va">n_sims</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">rep_constant_backend</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">SBC_backend_cmdstan_sample</span><span class="op">(</span></span>
<span>    <span class="fu">cmdstanr</span><span class="fu">::</span><span class="fu">cmdstan_model</span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/sbc_rep_constant_model.stan"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">rep_constant_results</span> <span class="op">&lt;-</span> <span class="fu">compute_SBC</span><span class="op">(</span><span class="va">rep_constant_dataset</span>, <span class="va">rep_constant_backend</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot_ecdf</span><span class="op">(</span><span class="va">rep_constant_results</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/sbc_vignette/rep-constant-1.png" alt=""><p class="caption">plot of chunk rep-constant</p>
</div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_rank_hist</span><span class="op">(</span><span class="va">rep_constant_results</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/sbc_vignette/rep-constant-2.png" alt=""><p class="caption">plot of chunk rep-constant</p>
</div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_ecdf_diff</span><span class="op">(</span><span class="va">rep_constant_results</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/sbc_vignette/rep-constant-3.png" alt=""><p class="caption">plot of chunk rep-constant</p>
</div>
</div>
<div class="section level3">
<h3 id="rep-varying">Rep-varying<a class="anchor" aria-label="anchor" href="#rep-varying"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make the stancode</span></span>
<span><span class="va">model_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/sbc_rep_varying_model.stan"</span><span class="op">)</span></span>
<span><span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_flocker_data.html">simulate_flocker_data</a></span><span class="op">(</span></span>
<span>  n_pt <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">n_sites</span>, n_sp <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    coefs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      det_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      det_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      det_slope_visit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      occ_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      occ_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  rep_constant <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  ragged_rep <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">flocker_data</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_flocker_data.html">make_flocker_data</a></span><span class="op">(</span><span class="va">fd</span><span class="op">$</span><span class="va">obs</span>, <span class="va">fd</span><span class="op">$</span><span class="va">unit_covs</span>, <span class="va">fd</span><span class="op">$</span><span class="va">event_covs</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">scode</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flocker_stancode.html">flocker_stancode</a></span><span class="op">(</span></span>
<span>    f_occ <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span>,</span>
<span>    f_det <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span> <span class="op">+</span> <span class="va">ec1</span>,</span>
<span>    flocker_data <span class="op">=</span> <span class="va">flocker_data</span>,</span>
<span>    prior <span class="op">=</span> </span>
<span>      <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span><span class="st">"std_normal()"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span><span class="st">"std_normal()"</span>, dpar <span class="op">=</span> <span class="st">"occ"</span><span class="op">)</span>,</span>
<span>    backend <span class="op">=</span> <span class="st">"cmdstanr"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">scode</span>, <span class="va">model_name</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rep_varying_generator</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">{</span>  </span>
<span>  <span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_flocker_data.html">simulate_flocker_data</a></span><span class="op">(</span></span>
<span>    n_pt <span class="op">=</span> <span class="va">N</span>, n_sp <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      coefs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        det_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        det_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        det_slope_visit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        occ_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        occ_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    rep_constant <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    ragged_rep <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">flocker_data</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_flocker_data.html">make_flocker_data</a></span><span class="op">(</span><span class="va">fd</span><span class="op">$</span><span class="va">obs</span>, <span class="va">fd</span><span class="op">$</span><span class="va">unit_covs</span>, <span class="va">fd</span><span class="op">$</span><span class="va">event_covs</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># format for return</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      `b[1]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">det_intercept</span>,</span>
<span>      `b[2]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">det_slope_unit</span>,</span>
<span>      `b[3]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">det_slope_visit</span>,</span>
<span>      `b_occ[1]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">occ_intercept</span>,</span>
<span>      `b_occ[2]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">occ_slope_unit</span></span>
<span>    <span class="op">)</span>,</span>
<span>    generated <span class="op">=</span> <span class="fu"><a href="../reference/flocker_standata.html">flocker_standata</a></span><span class="op">(</span></span>
<span>      f_occ <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span>,</span>
<span>      f_det <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span> <span class="op">+</span> <span class="va">ec1</span>,</span>
<span>      flocker_data <span class="op">=</span> <span class="va">flocker_data</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">rep_varying_gen</span> <span class="op">&lt;-</span> <span class="fu">SBC_generator_function</span><span class="op">(</span></span>
<span>  <span class="va">rep_varying_generator</span>, </span>
<span>  N <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">n_sites</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">rep_varying_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span></span>
<span>  <span class="fu">generate_datasets</span><span class="op">(</span><span class="va">rep_varying_gen</span>, <span class="va">params</span><span class="op">$</span><span class="va">n_sims</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">rep_varying_backend</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">SBC_backend_cmdstan_sample</span><span class="op">(</span></span>
<span>    <span class="fu">cmdstanr</span><span class="fu">::</span><span class="fu">cmdstan_model</span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/sbc_rep_varying_model.stan"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">rep_varying_results</span> <span class="op">&lt;-</span> <span class="fu">compute_SBC</span><span class="op">(</span><span class="va">rep_varying_dataset</span>, <span class="va">rep_varying_backend</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  - 3 (0%) fits had at least one Rhat &gt; 1.01. Largest Rhat was 1.016.</span></span></code></pre>
<pre><code><span><span class="co">## Not all diagnostics are OK.</span></span>
<span><span class="co">## You can learn more by inspecting $default_diagnostics, $backend_diagnostics </span></span>
<span><span class="co">## and/or investigating $outputs/$messages/$warnings for detailed output from the backend.</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_ecdf</span><span class="op">(</span><span class="va">rep_varying_results</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/sbc_vignette/rep-varying-1.png" alt=""><p class="caption">plot of chunk rep-varying</p>
</div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_rank_hist</span><span class="op">(</span><span class="va">rep_varying_results</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/sbc_vignette/rep-varying-2.png" alt=""><p class="caption">plot of chunk rep-varying</p>
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_ecdf_diff</span><span class="op">(</span><span class="va">rep_varying_results</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/sbc_vignette/rep-varying-3.png" alt=""><p class="caption">plot of chunk rep-varying</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="multi-season">Multi-season<a class="anchor" aria-label="anchor" href="#multi-season"></a>
</h2>
<p><code>flocker</code> fits multi-season models that parameterize the
dynamics using colonization/extinction or autologistic specifications,
and that parameterize the initial occupancy state using explicit and
equilibrium parameterizations, for a total of four classes of
multi-season model. We validate each class.</p>
<div class="section level3">
<h3 id="colonization-extinction-explicit-initial-occupancy">Colonization-extinction, explicit initial occupancy<a class="anchor" aria-label="anchor" href="#colonization-extinction-explicit-initial-occupancy"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make the stancode</span></span>
<span><span class="va">model_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/sbc_colex_ex_model.stan"</span><span class="op">)</span></span>
<span><span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_flocker_data.html">simulate_flocker_data</a></span><span class="op">(</span></span>
<span>  n_pt <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">n_sites</span>, n_sp <span class="op">=</span> <span class="fl">1</span>, n_season <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    coefs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      det_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      det_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      det_slope_visit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      occ_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      occ_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      col_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      col_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      ex_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      ex_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  rep_constant <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  multiseason <span class="op">=</span> <span class="st">"colex"</span>,</span>
<span>  multi_init <span class="op">=</span> <span class="st">"explicit"</span>,</span>
<span>  ragged_rep <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">flocker_data</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_flocker_data.html">make_flocker_data</a></span><span class="op">(</span></span>
<span>  <span class="va">fd</span><span class="op">$</span><span class="va">obs</span>, <span class="va">fd</span><span class="op">$</span><span class="va">unit_covs</span>, <span class="va">fd</span><span class="op">$</span><span class="va">event_covs</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"multi"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">scode</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flocker_stancode.html">flocker_stancode</a></span><span class="op">(</span></span>
<span>    f_occ <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span>,</span>
<span>    f_col <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span>,</span>
<span>    f_ex <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span>,</span>
<span>    f_det <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span> <span class="op">+</span> <span class="va">ec1</span>,</span>
<span>    flocker_data <span class="op">=</span> <span class="va">flocker_data</span>,</span>
<span>    prior <span class="op">=</span> </span>
<span>      <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span><span class="st">"std_normal()"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span><span class="st">"std_normal()"</span>, dpar <span class="op">=</span> <span class="st">"occ"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span><span class="st">"std_normal()"</span>, dpar <span class="op">=</span> <span class="st">"colo"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span><span class="st">"std_normal()"</span>, dpar <span class="op">=</span> <span class="st">"ex"</span><span class="op">)</span>,</span>
<span>    multiseason <span class="op">=</span> <span class="st">"colex"</span>,</span>
<span>    multi_init <span class="op">=</span> <span class="st">"explicit"</span>,</span>
<span>    backend <span class="op">=</span> <span class="st">"cmdstanr"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">scode</span>, <span class="va">model_name</span><span class="op">)</span></span>
<span></span>
<span><span class="va">colex_ex_generator</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">{</span>  </span>
<span>  <span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_flocker_data.html">simulate_flocker_data</a></span><span class="op">(</span></span>
<span>    n_pt <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">n_sites</span>, n_sp <span class="op">=</span> <span class="fl">1</span>, n_season <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        det_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        det_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        det_slope_visit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        occ_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        occ_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        colo_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        colo_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        ex_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        ex_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    rep_constant <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    multiseason <span class="op">=</span> <span class="st">"colex"</span>,</span>
<span>    multi_init <span class="op">=</span> <span class="st">"explicit"</span>,</span>
<span>    ragged_rep <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">flocker_data</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_flocker_data.html">make_flocker_data</a></span><span class="op">(</span></span>
<span>    <span class="va">fd</span><span class="op">$</span><span class="va">obs</span>, <span class="va">fd</span><span class="op">$</span><span class="va">unit_covs</span>, <span class="va">fd</span><span class="op">$</span><span class="va">event_covs</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"multi"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># format for return</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      `b[1]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">det_intercept</span>,</span>
<span>      `b[2]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">det_slope_unit</span>,</span>
<span>      `b[3]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">det_slope_visit</span>,</span>
<span>      `b_occ[1]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">occ_intercept</span>,</span>
<span>      `b_occ[2]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">occ_slope_unit</span>,</span>
<span>      `b_colo[1]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">col_intercept</span>,</span>
<span>      `b_colo[2]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">col_slope_unit</span>,</span>
<span>      `b_ex[1]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">ex_intercept</span>,</span>
<span>      `b_ex[2]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">ex_slope_unit</span></span>
<span>    <span class="op">)</span>,</span>
<span>    generated <span class="op">=</span> <span class="fu"><a href="../reference/flocker_standata.html">flocker_standata</a></span><span class="op">(</span></span>
<span>      f_occ <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span>,</span>
<span>      f_col <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span>,</span>
<span>      f_ex <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span>,</span>
<span>      f_det <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span> <span class="op">+</span> <span class="va">ec1</span>,</span>
<span>      flocker_data <span class="op">=</span> <span class="va">flocker_data</span>,</span>
<span>      multiseason <span class="op">=</span> <span class="st">"colex"</span>,</span>
<span>      multi_init <span class="op">=</span> <span class="st">"explicit"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">colex_ex_gen</span> <span class="op">&lt;-</span> <span class="fu">SBC_generator_function</span><span class="op">(</span></span>
<span>  <span class="va">colex_ex_generator</span>, </span>
<span>  N <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">n_sites</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">colex_ex_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span></span>
<span>  <span class="fu">generate_datasets</span><span class="op">(</span><span class="va">colex_ex_gen</span>, <span class="va">params</span><span class="op">$</span><span class="va">n_sims</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">colex_ex_backend</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">SBC_backend_cmdstan_sample</span><span class="op">(</span></span>
<span>    <span class="fu">cmdstanr</span><span class="fu">::</span><span class="fu">cmdstan_model</span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/sbc_colex_ex_model.stan"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">colex_ex_results</span> <span class="op">&lt;-</span> <span class="fu">compute_SBC</span><span class="op">(</span><span class="va">colex_ex_dataset</span>, <span class="va">colex_ex_backend</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot_ecdf</span><span class="op">(</span><span class="va">colex_ex_results</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/sbc_vignette/multi-colex-ex-1.png" alt=""><p class="caption">plot of chunk multi-colex-ex</p>
</div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_rank_hist</span><span class="op">(</span><span class="va">colex_ex_results</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/sbc_vignette/multi-colex-ex-2.png" alt=""><p class="caption">plot of chunk multi-colex-ex</p>
</div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_ecdf_diff</span><span class="op">(</span><span class="va">colex_ex_results</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/sbc_vignette/multi-colex-ex-3.png" alt=""><p class="caption">plot of chunk multi-colex-ex</p>
</div>
</div>
<div class="section level3">
<h3 id="colonization-extinction-equilibrium-initial-occupancy">Colonization-extinction, equilibrium initial occupancy<a class="anchor" aria-label="anchor" href="#colonization-extinction-equilibrium-initial-occupancy"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make the stancode</span></span>
<span><span class="va">model_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/sbc_colex_eq_model.stan"</span><span class="op">)</span></span>
<span><span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_flocker_data.html">simulate_flocker_data</a></span><span class="op">(</span></span>
<span>  n_pt <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">n_sites</span>, n_sp <span class="op">=</span> <span class="fl">1</span>, n_season <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      det_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      det_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      det_slope_visit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      colo_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      colo_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      ex_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      ex_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  rep_constant <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  multiseason <span class="op">=</span> <span class="st">"colex"</span>,</span>
<span>  multi_init <span class="op">=</span> <span class="st">"equilibrium"</span>,</span>
<span>  ragged_rep <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">flocker_data</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_flocker_data.html">make_flocker_data</a></span><span class="op">(</span></span>
<span>  <span class="va">fd</span><span class="op">$</span><span class="va">obs</span>, <span class="va">fd</span><span class="op">$</span><span class="va">unit_covs</span>, <span class="va">fd</span><span class="op">$</span><span class="va">event_covs</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"multi"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">scode</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flocker_stancode.html">flocker_stancode</a></span><span class="op">(</span></span>
<span>  f_col <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span>,</span>
<span>  f_ex <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span>,</span>
<span>  f_det <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span> <span class="op">+</span> <span class="va">ec1</span>,</span>
<span>  flocker_data <span class="op">=</span> <span class="va">flocker_data</span>,</span>
<span>  prior <span class="op">=</span> </span>
<span>    <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span><span class="st">"std_normal()"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span><span class="st">"std_normal()"</span>, dpar <span class="op">=</span> <span class="st">"colo"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span><span class="st">"std_normal()"</span>, dpar <span class="op">=</span> <span class="st">"ex"</span><span class="op">)</span>,</span>
<span>  multiseason <span class="op">=</span> <span class="st">"colex"</span>,</span>
<span>  multi_init <span class="op">=</span> <span class="st">"equilibrium"</span>,</span>
<span>  backend <span class="op">=</span> <span class="st">"cmdstanr"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">scode</span>, <span class="va">model_name</span><span class="op">)</span></span>
<span></span>
<span><span class="va">colex_eq_generator</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">{</span>  </span>
<span>  <span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_flocker_data.html">simulate_flocker_data</a></span><span class="op">(</span></span>
<span>    n_pt <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">n_sites</span>, n_sp <span class="op">=</span> <span class="fl">1</span>, n_season <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        det_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        det_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        det_slope_visit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        col_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        col_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        ex_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        ex_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    rep_constant <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    multiseason <span class="op">=</span> <span class="st">"colex"</span>,</span>
<span>    multi_init <span class="op">=</span> <span class="st">"equilibrium"</span>,</span>
<span>    ragged_rep <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">flocker_data</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_flocker_data.html">make_flocker_data</a></span><span class="op">(</span></span>
<span>    <span class="va">fd</span><span class="op">$</span><span class="va">obs</span>, <span class="va">fd</span><span class="op">$</span><span class="va">unit_covs</span>, <span class="va">fd</span><span class="op">$</span><span class="va">event_covs</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"multi"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># format for return</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      `b[1]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">det_intercept</span>,</span>
<span>      `b[2]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">det_slope_unit</span>,</span>
<span>      `b[3]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">det_slope_visit</span>,</span>
<span>      `b_colo[1]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">col_intercept</span>,</span>
<span>      `b_colo[2]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">col_slope_unit</span>,</span>
<span>      `b_ex[1]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">ex_intercept</span>,</span>
<span>      `b_ex[2]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">ex_slope_unit</span></span>
<span>    <span class="op">)</span>,</span>
<span>    generated <span class="op">=</span> <span class="fu"><a href="../reference/flocker_standata.html">flocker_standata</a></span><span class="op">(</span></span>
<span>      f_col <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span>,</span>
<span>      f_ex <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span>,</span>
<span>      f_det <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span> <span class="op">+</span> <span class="va">ec1</span>,</span>
<span>      flocker_data <span class="op">=</span> <span class="va">flocker_data</span>,</span>
<span>      multiseason <span class="op">=</span> <span class="st">"colex"</span>,</span>
<span>      multi_init <span class="op">=</span> <span class="st">"equilibrium"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">colex_eq_gen</span> <span class="op">&lt;-</span> <span class="fu">SBC_generator_function</span><span class="op">(</span></span>
<span>  <span class="va">colex_eq_generator</span>, </span>
<span>  N <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">n_sites</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">colex_eq_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span></span>
<span>  <span class="fu">generate_datasets</span><span class="op">(</span><span class="va">colex_eq_gen</span>, <span class="va">params</span><span class="op">$</span><span class="va">n_sims</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">colex_eq_backend</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">SBC_backend_cmdstan_sample</span><span class="op">(</span></span>
<span>    <span class="fu">cmdstanr</span><span class="fu">::</span><span class="fu">cmdstan_model</span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/sbc_colex_eq_model.stan"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">colex_eq_results</span> <span class="op">&lt;-</span> <span class="fu">compute_SBC</span><span class="op">(</span><span class="va">colex_eq_dataset</span>, <span class="va">colex_eq_backend</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  - 1 (0%) fits had at least one Rhat &gt; 1.01. Largest Rhat was 1.012.</span></span></code></pre>
<pre><code><span><span class="co">##  - 853 (85%) fits had some steps rejected. Maximum number of rejections was 5.</span></span></code></pre>
<pre><code><span><span class="co">## Not all diagnostics are OK.</span></span>
<span><span class="co">## You can learn more by inspecting $default_diagnostics, $backend_diagnostics </span></span>
<span><span class="co">## and/or investigating $outputs/$messages/$warnings for detailed output from the backend.</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_ecdf</span><span class="op">(</span><span class="va">colex_eq_results</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/sbc_vignette/multi-colex-eq-1.png" alt=""><p class="caption">plot of chunk multi-colex-eq</p>
</div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_rank_hist</span><span class="op">(</span><span class="va">colex_eq_results</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/sbc_vignette/multi-colex-eq-2.png" alt=""><p class="caption">plot of chunk multi-colex-eq</p>
</div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_ecdf_diff</span><span class="op">(</span><span class="va">colex_eq_results</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/sbc_vignette/multi-colex-eq-3.png" alt=""><p class="caption">plot of chunk multi-colex-eq</p>
</div>
</div>
<div class="section level3">
<h3 id="autologistic-explicit-initial-occupancy">Autologistic, explicit initial occupancy<a class="anchor" aria-label="anchor" href="#autologistic-explicit-initial-occupancy"></a>
</h3>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make the stancode</span></span>
<span><span class="va">model_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/sbc_auto_ex_model.stan"</span><span class="op">)</span></span>
<span><span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_flocker_data.html">simulate_flocker_data</a></span><span class="op">(</span></span>
<span>  n_pt <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">n_sites</span>, n_sp <span class="op">=</span> <span class="fl">1</span>, n_season <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      det_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      det_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      det_slope_visit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      occ_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      occ_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      col_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      col_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      auto_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      auto_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  rep_constant <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  multiseason <span class="op">=</span> <span class="st">"autologistic"</span>,</span>
<span>  multi_init <span class="op">=</span> <span class="st">"explicit"</span>,</span>
<span>  ragged_rep <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">flocker_data</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_flocker_data.html">make_flocker_data</a></span><span class="op">(</span></span>
<span>  <span class="va">fd</span><span class="op">$</span><span class="va">obs</span>, <span class="va">fd</span><span class="op">$</span><span class="va">unit_covs</span>, <span class="va">fd</span><span class="op">$</span><span class="va">event_covs</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"multi"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">scode</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flocker_stancode.html">flocker_stancode</a></span><span class="op">(</span></span>
<span>    f_occ <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span>,</span>
<span>    f_col <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span>,</span>
<span>    f_auto <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span>,</span>
<span>    f_det <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span> <span class="op">+</span> <span class="va">ec1</span>,</span>
<span>    flocker_data <span class="op">=</span> <span class="va">flocker_data</span>,</span>
<span>    prior <span class="op">=</span> </span>
<span>      <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span><span class="st">"std_normal()"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span><span class="st">"std_normal()"</span>, dpar <span class="op">=</span> <span class="st">"occ"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span><span class="st">"std_normal()"</span>, dpar <span class="op">=</span> <span class="st">"colo"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span><span class="st">"std_normal()"</span>, dpar <span class="op">=</span> <span class="st">"autologistic"</span><span class="op">)</span>,</span>
<span>    multiseason <span class="op">=</span> <span class="st">"autologistic"</span>,</span>
<span>    multi_init <span class="op">=</span> <span class="st">"explicit"</span>,</span>
<span>    backend <span class="op">=</span> <span class="st">"cmdstanr"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">scode</span>, <span class="va">model_name</span><span class="op">)</span></span>
<span></span>
<span><span class="va">auto_ex_generator</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">{</span>  </span>
<span>  <span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_flocker_data.html">simulate_flocker_data</a></span><span class="op">(</span></span>
<span>    n_pt <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">n_sites</span>, n_sp <span class="op">=</span> <span class="fl">1</span>, n_season <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        det_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        det_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        det_slope_visit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        occ_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        occ_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        colo_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        colo_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        auto_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        auto_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    rep_constant <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    multiseason <span class="op">=</span> <span class="st">"autologistic"</span>,</span>
<span>    multi_init <span class="op">=</span> <span class="st">"explicit"</span>,</span>
<span>    ragged_rep <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">flocker_data</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_flocker_data.html">make_flocker_data</a></span><span class="op">(</span></span>
<span>    <span class="va">fd</span><span class="op">$</span><span class="va">obs</span>, <span class="va">fd</span><span class="op">$</span><span class="va">unit_covs</span>, <span class="va">fd</span><span class="op">$</span><span class="va">event_covs</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"multi"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># format for return</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      `b[1]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">det_intercept</span>,</span>
<span>      `b[2]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">det_slope_unit</span>,</span>
<span>      `b[3]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">det_slope_visit</span>,</span>
<span>      `b_occ[1]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">occ_intercept</span>,</span>
<span>      `b_occ[2]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">occ_slope_unit</span>,</span>
<span>      `b_colo[1]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">col_intercept</span>,</span>
<span>      `b_colo[2]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">col_slope_unit</span>,</span>
<span>      `b_autologistic[1]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">auto_intercept</span>,</span>
<span>      `b_autologistic[2]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">auto_slope_unit</span></span>
<span>    <span class="op">)</span>,</span>
<span>    generated <span class="op">=</span> <span class="fu"><a href="../reference/flocker_standata.html">flocker_standata</a></span><span class="op">(</span></span>
<span>      f_occ <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span>,</span>
<span>      f_col <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span>,</span>
<span>      f_auto <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span>,</span>
<span>      f_det <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span> <span class="op">+</span> <span class="va">ec1</span>,</span>
<span>      flocker_data <span class="op">=</span> <span class="va">flocker_data</span>,</span>
<span>      multiseason <span class="op">=</span> <span class="st">"autologistic"</span>,</span>
<span>      multi_init <span class="op">=</span> <span class="st">"explicit"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">auto_ex_gen</span> <span class="op">&lt;-</span> <span class="fu">SBC_generator_function</span><span class="op">(</span></span>
<span>  <span class="va">auto_ex_generator</span>, </span>
<span>  N <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">n_sites</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">auto_ex_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span></span>
<span>  <span class="fu">generate_datasets</span><span class="op">(</span><span class="va">auto_ex_gen</span>, <span class="va">params</span><span class="op">$</span><span class="va">n_sims</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">auto_ex_backend</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">SBC_backend_cmdstan_sample</span><span class="op">(</span></span>
<span>    <span class="fu">cmdstanr</span><span class="fu">::</span><span class="fu">cmdstan_model</span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/sbc_auto_ex_model.stan"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">auto_ex_results</span> <span class="op">&lt;-</span> <span class="fu">compute_SBC</span><span class="op">(</span><span class="va">auto_ex_dataset</span>, <span class="va">auto_ex_backend</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plot_ecdf</span><span class="op">(</span><span class="va">auto_ex_results</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/sbc_vignette/multi-auto-ex-1.png" alt=""><p class="caption">plot of chunk multi-auto-ex</p>
</div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_rank_hist</span><span class="op">(</span><span class="va">auto_ex_results</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/sbc_vignette/multi-auto-ex-2.png" alt=""><p class="caption">plot of chunk multi-auto-ex</p>
</div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_ecdf_diff</span><span class="op">(</span><span class="va">auto_ex_results</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/sbc_vignette/multi-auto-ex-3.png" alt=""><p class="caption">plot of chunk multi-auto-ex</p>
</div>
</div>
<div class="section level3">
<h3 id="autologistic-equilibrium-initial-occupancy">Autologistic, equilibrium initial occupancy<a class="anchor" aria-label="anchor" href="#autologistic-equilibrium-initial-occupancy"></a>
</h3>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make the stancode</span></span>
<span><span class="va">model_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/sbc_auto_eq_model.stan"</span><span class="op">)</span></span>
<span><span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_flocker_data.html">simulate_flocker_data</a></span><span class="op">(</span></span>
<span>  n_pt <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">n_sites</span>, n_sp <span class="op">=</span> <span class="fl">1</span>, n_season <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      det_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      det_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      det_slope_visit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      auto_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>      auto_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  rep_constant <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  multiseason <span class="op">=</span> <span class="st">"autologistic"</span>,</span>
<span>  multi_init <span class="op">=</span> <span class="st">"equilibrium"</span>,</span>
<span>  ragged_rep <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">flocker_data</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_flocker_data.html">make_flocker_data</a></span><span class="op">(</span></span>
<span>  <span class="va">fd</span><span class="op">$</span><span class="va">obs</span>, <span class="va">fd</span><span class="op">$</span><span class="va">unit_covs</span>, <span class="va">fd</span><span class="op">$</span><span class="va">event_covs</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"multi"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">scode</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flocker_stancode.html">flocker_stancode</a></span><span class="op">(</span></span>
<span>    f_col <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span>,</span>
<span>    f_auto <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span>,</span>
<span>    f_det <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span> <span class="op">+</span> <span class="va">ec1</span>,</span>
<span>    flocker_data <span class="op">=</span> <span class="va">flocker_data</span>,</span>
<span>    prior <span class="op">=</span> </span>
<span>      <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span><span class="st">"std_normal()"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span><span class="st">"std_normal()"</span>, dpar <span class="op">=</span> <span class="st">"colo"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span><span class="st">"std_normal()"</span>, dpar <span class="op">=</span> <span class="st">"autologistic"</span><span class="op">)</span>,</span>
<span>    multiseason <span class="op">=</span> <span class="st">"autologistic"</span>,</span>
<span>    multi_init <span class="op">=</span> <span class="st">"equilibrium"</span>,</span>
<span>    backend <span class="op">=</span> <span class="st">"cmdstanr"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">scode</span>, <span class="va">model_name</span><span class="op">)</span></span>
<span></span>
<span><span class="va">auto_eq_generator</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">{</span>  </span>
<span>  <span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_flocker_data.html">simulate_flocker_data</a></span><span class="op">(</span></span>
<span>    n_pt <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">n_sites</span>, n_sp <span class="op">=</span> <span class="fl">1</span>, n_season <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        det_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        det_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        det_slope_visit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        col_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        col_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        auto_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>        auto_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    rep_constant <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    multiseason <span class="op">=</span> <span class="st">"autologistic"</span>,</span>
<span>    multi_init <span class="op">=</span> <span class="st">"equilibrium"</span>,</span>
<span>    ragged_rep <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">flocker_data</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_flocker_data.html">make_flocker_data</a></span><span class="op">(</span></span>
<span>    <span class="va">fd</span><span class="op">$</span><span class="va">obs</span>, <span class="va">fd</span><span class="op">$</span><span class="va">unit_covs</span>, <span class="va">fd</span><span class="op">$</span><span class="va">event_covs</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"multi"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># format for return</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      `b[1]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">det_intercept</span>,</span>
<span>      `b[2]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">det_slope_unit</span>,</span>
<span>      `b[3]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">det_slope_visit</span>,</span>
<span>      `b_colo[1]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">col_intercept</span>,</span>
<span>      `b_colo[2]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">col_slope_unit</span>,</span>
<span>      `b_autologistic[1]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">auto_intercept</span>,</span>
<span>      `b_autologistic[2]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coefs</span><span class="op">$</span><span class="va">auto_slope_unit</span></span>
<span>    <span class="op">)</span>,</span>
<span>    generated <span class="op">=</span> <span class="fu"><a href="../reference/flocker_standata.html">flocker_standata</a></span><span class="op">(</span></span>
<span>      f_col <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span>,</span>
<span>      f_auto <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span>,</span>
<span>      f_det <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span> <span class="op">+</span> <span class="va">ec1</span>,</span>
<span>      flocker_data <span class="op">=</span> <span class="va">flocker_data</span>,</span>
<span>      multiseason <span class="op">=</span> <span class="st">"autologistic"</span>,</span>
<span>      multi_init <span class="op">=</span> <span class="st">"equilibrium"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">auto_eq_gen</span> <span class="op">&lt;-</span> <span class="fu">SBC_generator_function</span><span class="op">(</span></span>
<span>  <span class="va">auto_eq_generator</span>, </span>
<span>  N <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">n_sites</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">auto_eq_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span></span>
<span>  <span class="fu">generate_datasets</span><span class="op">(</span><span class="va">auto_eq_gen</span>, <span class="va">params</span><span class="op">$</span><span class="va">n_sims</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">auto_eq_backend</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">SBC_backend_cmdstan_sample</span><span class="op">(</span></span>
<span>    <span class="fu">cmdstanr</span><span class="fu">::</span><span class="fu">cmdstan_model</span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/sbc_auto_eq_model.stan"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">auto_eq_results</span> <span class="op">&lt;-</span> <span class="fu">compute_SBC</span><span class="op">(</span><span class="va">auto_eq_dataset</span>, <span class="va">auto_eq_backend</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  - 302 (30%) fits had some steps rejected. Maximum number of rejections was 3.</span></span></code></pre>
<pre><code><span><span class="co">## Not all diagnostics are OK.</span></span>
<span><span class="co">## You can learn more by inspecting $default_diagnostics, $backend_diagnostics </span></span>
<span><span class="co">## and/or investigating $outputs/$messages/$warnings for detailed output from the backend.</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_ecdf</span><span class="op">(</span><span class="va">auto_eq_results</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/sbc_vignette/multi-auto-eq-1.png" alt=""><p class="caption">plot of chunk multi-auto-eq</p>
</div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_rank_hist</span><span class="op">(</span><span class="va">auto_eq_results</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/sbc_vignette/multi-auto-eq-2.png" alt=""><p class="caption">plot of chunk multi-auto-eq</p>
</div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_ecdf_diff</span><span class="op">(</span><span class="va">auto_eq_results</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/sbc_vignette/multi-auto-eq-3.png" alt=""><p class="caption">plot of chunk multi-auto-eq</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="data-augmented">Data-augmented<a class="anchor" aria-label="anchor" href="#data-augmented"></a>
</h2>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make the stancode</span></span>
<span><span class="va">model_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/sbc_augmented_model.stan"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">omega</span> <span class="op">&lt;-</span> <span class="fu">boot</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/boot/man/inv.logit.html" class="external-link">inv.logit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">available</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">params</span><span class="op">$</span><span class="va">n_pseudospecies_augmented</span>, <span class="va">omega</span><span class="op">)</span></span>
<span><span class="va">unavailable</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">n_pseudospecies_augmented</span> <span class="op">-</span> <span class="va">available</span></span>
<span><span class="va">coef_means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> <span class="co"># normal prior on random effect means</span></span>
<span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="co"># half-normal prior on all random effect sds</span></span>
<span><span class="va">Sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> <span class="op">*</span> <span class="va">sigma</span></span>
<span></span>
<span><span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_flocker_data.html">simulate_flocker_data</a></span><span class="op">(</span></span>
<span>  n_pt <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">n_sites_augmented</span>, n_sp <span class="op">=</span> <span class="va">available</span>,</span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    coef_means <span class="op">=</span> <span class="va">coef_means</span>,</span>
<span>    Sigma <span class="op">=</span> <span class="va">Sigma</span>,</span>
<span>    coefs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      det_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">available</span>, <span class="va">coef_means</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">sigma</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>      det_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">available</span>, <span class="va">coef_means</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">sigma</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>      det_slope_visit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">available</span>, <span class="va">coef_means</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">sigma</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>,</span>
<span>      occ_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">available</span>, <span class="va">coef_means</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, <span class="va">sigma</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>,</span>
<span>      occ_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">available</span>, <span class="va">coef_means</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>, <span class="va">sigma</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  rep_constant <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  ragged_rep <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">obs_aug</span> <span class="op">&lt;-</span> <span class="va">fd</span><span class="op">$</span><span class="va">obs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">n_sites_augmented</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">available</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">obs_aug</span> <span class="op">&lt;-</span> <span class="fu">abind</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/abind/man/abind.html" class="external-link">abind</a></span><span class="op">(</span></span>
<span>    <span class="va">obs_aug</span>, </span>
<span>    <span class="va">fd</span><span class="op">$</span><span class="va">obs</span><span class="op">[</span><span class="op">(</span><span class="op">(</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">params</span><span class="op">$</span><span class="va">n_sites_augmented</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">n_sites_augmented</span><span class="op">)</span>, <span class="op">]</span>, </span>
<span>    along <span class="op">=</span> <span class="fl">3</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">event_covs_aug</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ec1 <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">event_covs</span><span class="op">$</span><span class="va">ec1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">n_sites_augmented</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="va">unit_covs_aug</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>uc1 <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">unit_covs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">n_sites_augmented</span><span class="op">)</span>, <span class="st">"uc1"</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">flocker_data</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_flocker_data.html">make_flocker_data</a></span><span class="op">(</span></span>
<span>  <span class="va">obs_aug</span>, <span class="va">unit_covs_aug</span>, <span class="va">event_covs_aug</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"augmented"</span>, n_aug <span class="op">=</span> <span class="va">unavailable</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">scode</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/flocker_stancode.html">flocker_stancode</a></span><span class="op">(</span></span>
<span>    f_occ <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">uc1</span> <span class="op">||</span> <span class="va">ff_species</span><span class="op">)</span>,</span>
<span>    f_det <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span> <span class="op">+</span> <span class="va">ec1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">uc1</span> <span class="op">+</span> <span class="va">ec1</span> <span class="op">||</span> <span class="va">ff_species</span><span class="op">)</span>,</span>
<span>    flocker_data <span class="op">=</span> <span class="va">flocker_data</span>,</span>
<span>    prior <span class="op">=</span> </span>
<span>      <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span><span class="st">"std_normal()"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span><span class="st">"std_normal()"</span>, class <span class="op">=</span> <span class="st">"sd"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span><span class="st">"std_normal()"</span>, dpar <span class="op">=</span> <span class="st">"occ"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span><span class="st">"std_normal()"</span>, class <span class="op">=</span> <span class="st">"sd"</span>, dpar <span class="op">=</span> <span class="st">"occ"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/set_prior.html" class="external-link">set_prior</a></span><span class="op">(</span><span class="st">"normal(0, 0.1)"</span>, class <span class="op">=</span> <span class="st">"Intercept"</span>, dpar <span class="op">=</span> <span class="st">"Omega"</span><span class="op">)</span>,</span>
<span>    backend <span class="op">=</span> <span class="st">"cmdstanr"</span>,</span>
<span>    augmented <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">scode</span>, <span class="va">model_name</span><span class="op">)</span></span>
<span></span>
<span><span class="va">aug_generator</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">{</span>  </span>
<span>  <span class="va">omega</span> <span class="op">&lt;-</span> <span class="fu">boot</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/boot/man/inv.logit.html" class="external-link">inv.logit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">.1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">available</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">params</span><span class="op">$</span><span class="va">n_pseudospecies_augmented</span>, <span class="va">omega</span><span class="op">)</span></span>
<span>  <span class="va">unavailable</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">n_pseudospecies_augmented</span> <span class="op">-</span> <span class="va">available</span></span>
<span>  <span class="va">coef_means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> <span class="co"># normal prior on random effect means</span></span>
<span>  <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="co"># half-normal prior on all random effect sds</span></span>
<span>  <span class="va">Sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> <span class="op">*</span> <span class="va">sigma</span></span>
<span>  </span>
<span>  <span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_flocker_data.html">simulate_flocker_data</a></span><span class="op">(</span></span>
<span>    n_pt <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">n_sites_augmented</span>, n_sp <span class="op">=</span> <span class="va">available</span>,</span>
<span>    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      coef_means <span class="op">=</span> <span class="va">coef_means</span>,</span>
<span>      Sigma <span class="op">=</span> <span class="va">Sigma</span>,</span>
<span>      coefs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>        det_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">available</span>, <span class="va">coef_means</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">sigma</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,</span>
<span>        det_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">available</span>, <span class="va">coef_means</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">sigma</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>        det_slope_visit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">available</span>, <span class="va">coef_means</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">sigma</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>,</span>
<span>        occ_intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">available</span>, <span class="va">coef_means</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, <span class="va">sigma</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>,</span>
<span>        occ_slope_unit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">available</span>, <span class="va">coef_means</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>, <span class="va">sigma</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    rep_constant <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    ragged_rep <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">obs_aug</span> <span class="op">&lt;-</span> <span class="va">fd</span><span class="op">$</span><span class="va">obs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">n_sites_augmented</span><span class="op">)</span>, <span class="op">]</span></span>
<span>  </span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">available</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">obs_aug</span> <span class="op">&lt;-</span> <span class="fu">abind</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/abind/man/abind.html" class="external-link">abind</a></span><span class="op">(</span></span>
<span>      <span class="va">obs_aug</span>, </span>
<span>      <span class="va">fd</span><span class="op">$</span><span class="va">obs</span><span class="op">[</span><span class="op">(</span><span class="op">(</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">params</span><span class="op">$</span><span class="va">n_sites_augmented</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">n_sites_augmented</span><span class="op">)</span>, <span class="op">]</span>, </span>
<span>      along <span class="op">=</span> <span class="fl">3</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">event_covs_aug</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ec1 <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">event_covs</span><span class="op">$</span><span class="va">ec1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">n_sites_augmented</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">unit_covs_aug</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>uc1 <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">unit_covs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">n_sites_augmented</span><span class="op">)</span>, <span class="st">"uc1"</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">flocker_data</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_flocker_data.html">make_flocker_data</a></span><span class="op">(</span></span>
<span>    <span class="va">obs_aug</span>, <span class="va">unit_covs_aug</span>, <span class="va">event_covs_aug</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"augmented"</span>, n_aug <span class="op">=</span> <span class="va">unavailable</span>,</span>
<span>    quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="co"># format for return</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      `b[1]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coef_means</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>      `b[2]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coef_means</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>      `b[3]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coef_means</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,</span>
<span>      `b_occ[1]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coef_means</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>,</span>
<span>      `b_occ[2]` <span class="op">=</span> <span class="va">fd</span><span class="op">$</span><span class="va">params</span><span class="op">$</span><span class="va">coef_means</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>,</span>
<span>      `Intercept_Omega` <span class="op">=</span> <span class="fu">boot</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/boot/man/logit.html" class="external-link">logit</a></span><span class="op">(</span><span class="va">omega</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    generated <span class="op">=</span> <span class="fu"><a href="../reference/flocker_standata.html">flocker_standata</a></span><span class="op">(</span></span>
<span>      f_occ <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">uc1</span> <span class="op">||</span> <span class="va">ff_species</span><span class="op">)</span>,</span>
<span>      f_det <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">Intercept</span> <span class="op">+</span> <span class="va">uc1</span> <span class="op">+</span> <span class="va">ec1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">uc1</span> <span class="op">+</span> <span class="va">ec1</span> <span class="op">||</span> <span class="va">ff_species</span><span class="op">)</span>,</span>
<span>      flocker_data <span class="op">=</span> <span class="va">flocker_data</span>,</span>
<span>      augmented <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">aug_gen</span> <span class="op">&lt;-</span> <span class="fu">SBC_generator_function</span><span class="op">(</span></span>
<span>  <span class="va">aug_generator</span>, </span>
<span>  N <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">n_sites_augmented</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">aug_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span></span>
<span>  <span class="fu">generate_datasets</span><span class="op">(</span><span class="va">aug_gen</span>, <span class="va">params</span><span class="op">$</span><span class="va">n_sims_augmented</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">aug_backend</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">SBC_backend_cmdstan_sample</span><span class="op">(</span></span>
<span>    <span class="fu">cmdstanr</span><span class="fu">::</span><span class="fu">cmdstan_model</span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/sbc_augmented_model.stan"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">aug_results</span> <span class="op">&lt;-</span> <span class="fu">compute_SBC</span><span class="op">(</span><span class="va">aug_dataset</span>, <span class="va">aug_backend</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  - 4 (2%) fits had at least one Rhat &gt; 1.01. Largest Rhat was 1.022.</span></span></code></pre>
<pre><code><span><span class="co">##  - 2 (1%) fits had divergent transitions. Maximum number of divergences was 2.</span></span></code></pre>
<pre><code><span><span class="co">##  - 7 (4%) fits had some steps rejected. Maximum number of rejections was 1.</span></span></code></pre>
<pre><code><span><span class="co">## Not all diagnostics are OK.</span></span>
<span><span class="co">## You can learn more by inspecting $default_diagnostics, $backend_diagnostics </span></span>
<span><span class="co">## and/or investigating $outputs/$messages/$warnings for detailed output from the backend.</span></span></code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_ecdf</span><span class="op">(</span><span class="va">aug_results</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/sbc_vignette/data-augmented-1.png" alt=""><p class="caption">plot of chunk data-augmented</p>
</div>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_rank_hist</span><span class="op">(</span><span class="va">aug_results</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/sbc_vignette/data-augmented-2.png" alt=""><p class="caption">plot of chunk data-augmented</p>
</div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_ecdf_diff</span><span class="op">(</span><span class="va">aug_results</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="../reference/figures/sbc_vignette/data-augmented-3.png" alt=""><p class="caption">plot of chunk data-augmented</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jacob B. Socolar, Simon C. Mills.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
